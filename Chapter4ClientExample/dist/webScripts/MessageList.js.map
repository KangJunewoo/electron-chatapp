{"version":3,"sources":["../../webScripts/MessageList.js"],"names":["MessageList","document","Error","MessageItemFactory","require","items","getElementById","ItemFactory","renderTasks","TaskCount","listener","undefined","prototype","rows","pageNo","addItem","message","messageItem","createItem","id","item","appendChild","push","scrollToBottom","loadItem","Promise","resolve","sortList","reject","list","slice","call","sort","a","b","aDate","getElementsByClassName","bDate","console","log","getAttribute","updateList","messageList","forEach","element","changeSuccessStatus","index","length","changeSuccessStatusMessage","result","splice","childNodes","then","bind","catch","e","changeFailureStatus","changeFailureStatusMessage","clearItems","firstChild","removeChild","lastChild","scrollTop","scrollHeight","setScrollListener","removeEventListener","addEventListener","module","exports"],"mappings":"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","file":"MessageList.js","sourcesContent":["/**\n * Created by kishe56@gmail.com on 2018. 9. 17.\n * Blog : https://kishe89.github.io\n * Github : https://github.com/kishe89\n */\n'use strict';\n\nfunction MessageList(document) {\n  if(!(this instanceof MessageList)){\n    throw new Error('must be created with new keyword');\n  }\n  const MessageItemFactory = require('./MessageItemFactory');\n  this.items = document.getElementById('messageList');\n  this.ItemFactory = new MessageItemFactory(document);\n  this.renderTasks = [];\n  this.TaskCount = 0;\n  this.listener = undefined;\n}\nMessageList.prototype.rows = [];\nMessageList.prototype.pageNo = 0;\n\nMessageList.prototype.addItem = function (message) {\n  const messageItem = this.ItemFactory.createItem(message);\n  messageItem.id = this.TaskCount;\n  messageItem.item.id = this.TaskCount;\n  this.TaskCount++;\n  this.items.appendChild(messageItem.item);\n  this.renderTasks.push(messageItem);\n  this.scrollToBottom();\n  return messageItem;\n};\nMessageList.prototype.loadItem = function (message) {\n  const messageItem = this.ItemFactory.loadItem(message);\n  this.items.appendChild(messageItem);\n  return Promise.resolve();\n};\nMessageList.prototype.sortList = function(items) {\n  return new Promise((resolve,reject)=>{\n    if(!items) return reject();\n    const list = [].slice.call(items).sort(function (a, b) {\n      const aDate = a.getElementsByClassName('messageElementDate')[0];\n      const bDate = b.getElementsByClassName('messageElementDate')[0];\n      console.log(`${aDate.getAttribute('data-value')} > ${bDate.getAttribute('data-value')} is ${aDate.getAttribute('data-value') > bDate.getAttribute('data-value')}`);\n      return aDate.getAttribute('data-value') > bDate.getAttribute('data-value') ? 1 : -1;\n    });\n    resolve(list);\n  });\n};\nMessageList.prototype.updateList = function (items) {\n  const messageList = this.items;\n  items.forEach((element)=>{\n    messageList.appendChild(element);\n    this.scrollToBottom();\n  });\n};\nMessageList.prototype.changeSuccessStatus = function (message) {\n  for(let index = 0; index<this.renderTasks.length; index++){\n    if(this.renderTasks[index].id === message.item.id){\n      this.ItemFactory.changeSuccessStatusMessage(this.renderTasks[index],message.result);\n      this.renderTasks.splice(index,1);\n      this.TaskCount--;\n      this.sortList(this.items.childNodes)\n        .then(this.updateList.bind(this))\n        .catch((e)=>{\n          console.log(e);\n        });\n      return;\n    }\n  }\n};\nMessageList.prototype.changeFailureStatus = function (message,listener) {\n  for(let index = 0; index<this.renderTasks.length; index++){\n    if(this.renderTasks[index].id === message.item.id){\n      this.ItemFactory.changeFailureStatusMessage(this.renderTasks[index],message.result,listener);\n      return;\n    }\n  }\n};\nMessageList.prototype.clearItems = function () {\n  const items = this.items;\n  return new Promise((resolve,reject)=>{\n    while(items.firstChild){\n      items.removeChild(items.lastChild);\n    }\n    resolve();\n  });\n};\n\nMessageList.prototype.scrollToBottom = function () {\n  this.items.scrollTop = this.items.scrollHeight;\n};\nMessageList.prototype.setScrollListener = function (listener) {\n  if(this.listener){\n    this.items.removeEventListener('scroll',this.listener);\n  }\n  this.listener = listener;\n  this.items.addEventListener('scroll',this.listener);\n};\nmodule.exports = MessageList;"]}