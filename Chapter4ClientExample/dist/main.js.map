{"version":3,"sources":["../main.js"],"names":["electron","require","app","BrowserWindow","ipcMain","url","path","io","axios","httpInstance","create","baseURL","handler_manager","SocketService","SocketEvent","TokenManager","tokenManager","MainWindowActions","win","socket","modal","waitDialog","listener","errorListener","locale","displayLoginWindow","event","message","screen","getPrimaryDisplay","workAreaSize","width","height","options","resizable","fullscreenable","show","webPreferences","affinity","nodeIntegration","loadURL","format","pathname","join","__dirname","protocol","slashes","webContents","openDevTools","once","console","log","on","quit","displaySignUpModal","send","parent","destroySignUpModal","close","createSignUpRequest","post","then","response","sender","data","catch","error","result","status","statusText","displayWaitDialog","frame","hide","socketURL","socketOptions","transports","forceNew","reconnection","reconnectionDelay","reconnectionDelayMax","reconnectionAttempts","Infinity","query","id","getId","token","createSocket","setToken","addHandler","CONNECT","addHandlerWithTokenManager","ERROR","destroyWaitDialog","removeListener","clearHistory","setResizable","setFullScreenable","setMinimumSize","addHandlers","RECONNECT_ATTEMPT","DISCONNECT","TOKENREFRESHREQUIRED","BROADCAST_MESSAGE","RECEIVE_INVITEUSER","getLocale","name","setId"],"mappings":"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","file":"main.js","sourcesContent":["/**\n * Created by kishe56@gmail.com on 2018. 6. 28.\n * Blog : https://kishe89.github.io\n * Github : https://github.com/kishe89\n */\n'use strict';\n\nconst electron = require('electron');\nconst {app,BrowserWindow,ipcMain} = electron;\nconst url = require('url');\nconst path = require('path');\nconst io = require('socket.io-client');\nconst axios = require('axios');\nconst httpInstance = axios.create({\n  baseURL:'http://electronexampleserver.mybluemix.net'\n});\n\nconst handler_manager = require('./handler_manager');\nconst SocketService = require('./service/SocketService');\nconst SocketEvent = require('./handler_manager/event/SocketEvent');\nconst TokenManager = require('./service/TokenManager');\nconst tokenManager = new TokenManager();\nconst MainWindowActions = require('./mainProcess/MainWindowActions');\n\nlet win;\nlet socket;\nlet modal;\nlet waitDialog;\nlet listener;\nlet errorListener;\nlet locale;\n\nconst displayLoginWindow = (event, message)=>{\n  const {width,height} = electron.screen.getPrimaryDisplay().workAreaSize;\n  const options = {\n    width:width,\n    height:height,\n    resizable:false,\n    fullscreenable:false,\n    show:false,\n    webPreferences:{\n      affinity:true,\n      nodeIntegration:true\n    }\n  };\n  win = new BrowserWindow(options);\n  win.loadURL(url.format({\n    pathname:path.join(__dirname,'login.html'),\n    protocol:'file',\n    slashes:true\n  }));\n  win.webContents.openDevTools();\n  win.once('ready-to-show',()=>{\n    console.log('ready-to-show');\n    win.show();\n  });\n  win.on('closed',()=>{\n    console.log('window closed');\n    win = null;\n    app.quit();\n  });\n};\nconst displaySignUpModal = (event,message)=>{\n  win.webContents.send('hide-page');\n  modal = new BrowserWindow({parent:win,modal:true,show:false});\n\n  modal.loadURL(url.format({\n    pathname:path.join(__dirname,'SignUpModal.html'),\n    protocol:'file:'\n  }));\n  modal.once('ready-to-show',()=>{\n    modal.show();\n  });\n  modal.on('closed',()=>{\n    modal = null;\n  });\n};\nconst destroySignUpModal = (event,message)=>{\n  win.webContents.send('hide-page');\n  modal.close();\n};\nconst createSignUpRequest = (event, message)=>{\n  httpInstance.post('/users',message)\n    .then((response)=>{\n      event.sender.send('signUpRequest-Success',response.data);\n    })\n    .catch((error)=>{\n      const result = {\n        status:error.response.status,\n        statusText:error.response.statusText\n      };\n      event.sender.send('signUpRequest-Failed',result);\n    })\n};\nconst displayWaitDialog = (event, message)=>{\n  const options = {\n    width:800,\n    height:800,\n    resizable:false,\n    fullscreenable:false,\n    show:false,\n    frame:false,\n    webPreferences:{\n      affinity:true,\n      nodeIntegration:true\n    }\n  };\n  waitDialog = new BrowserWindow(options);\n  waitDialog.loadURL(url.format({\n    pathname:path.join(__dirname,'WaitDialog.html'),\n    protocol:'file',\n    slashes:true\n  }));\n  waitDialog.once('ready-to-show',()=>{\n    win.hide();\n    waitDialog.show();\n    const socketURL = 'ws://electronexampleserver.mybluemix.net';\n    const socketOptions = {\n      transports:['websocket'],\n      forceNew:true,\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax : 5000,\n      reconnectionAttempts: Infinity,\n      query:{\n        id:tokenManager.getId(),\n        token:message.data.token\n      }\n    };\n    socket = SocketService.createSocket(io,socketURL,socketOptions);\n    tokenManager.setToken(message.data.token);\n    listener = SocketService.addHandler(socket,waitDialog,handler_manager[SocketEvent.CONNECT]);\n    errorListener = SocketService.addHandlerWithTokenManager(socket,waitDialog,handler_manager[SocketEvent.ERROR],tokenManager);\n    MainWindowActions(ipcMain,socket,tokenManager);\n  });\n  waitDialog.on('closed',()=>{\n    waitDialog = null;\n  });\n};\nconst destroyWaitDialog = (event, message)=>{\n  socket.removeListener('connect',listener);\n  socket.removeListener('error',errorListener);\n  win.webContents.clearHistory();\n  win.setResizable(true);\n  win.setFullScreenable(true);\n  win.setMinimumSize(600,600);\n  win.loadURL(url.format({\n    pathname:path.join(__dirname,'main.html'),\n    protocol:'file:',\n    slashes:true\n  }));\n  win.once('ready-to-show',()=>{\n    SocketService.addHandlers(socket,win,handler_manager);\n    SocketService.addHandler(socket,win,handler_manager[SocketEvent.CONNECT]);\n    SocketService.addHandlerWithTokenManager(socket,win,handler_manager[SocketEvent.RECONNECT_ATTEMPT],tokenManager);\n    SocketService.addHandlerWithTokenManager(socket,win,handler_manager[SocketEvent.DISCONNECT],tokenManager);\n    SocketService.addHandlerWithTokenManager(socket,win,handler_manager[SocketEvent.TOKENREFRESHREQUIRED],tokenManager);\n    SocketService.addHandlerWithTokenManager(socket,win,handler_manager[SocketEvent.BROADCAST_MESSAGE],tokenManager);\n    SocketService.addHandlerWithTokenManager(socket,win,handler_manager[SocketEvent.RECEIVE_INVITEUSER],tokenManager);\n    SocketService.addHandlerWithTokenManager(socket,win,handler_manager[SocketEvent.ERROR],tokenManager);\n    waitDialog.close();\n    locale = app.getLocale();\n    win.webContents.send('getProfile',{name:tokenManager.getId(),locale:locale});\n    win.show();\n  });\n};\napp.on('ready',displayLoginWindow);\nipcMain.on('displayWaitDialog',displayWaitDialog);\nipcMain.on('destroyWaitDialog',destroyWaitDialog);\nipcMain.on('displaySignUpModal',displaySignUpModal);\nipcMain.on('destroySignUpModal',destroySignUpModal);\nipcMain.on('signUpRequest',createSignUpRequest);\nipcMain.on('signInRequest',(event,message)=>{\n  httpInstance.post('/users/login',message)\n    .then((response)=>{\n      tokenManager.setId(message.id);\n      event.sender.send('signInRequest-Success',response);\n    })\n    .catch((error)=>{\n      const result = {\n        status:error.response.status,\n        statusText:error.response.statusText\n      };\n      event.sender.send('signInRequest-Failed',result);\n    })\n});\n\n\napp.on('window-all-closed',()=>{\n  app.quit();\n});\napp.on('activate',()=>{\n  app.quit();\n});"]}