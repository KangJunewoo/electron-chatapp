{"version":3,"sources":["../main.js"],"names":["electron","require","app","BrowserWindow","ipcMain","url","path","io","axios","httpInstance","create","baseURL","handler_manager","SocketService","SocketEvent","TokenManager","tokenManager","MainWindowActions","win","socket","modal","waitDialog","listener","errorListener","locale","displayLoginWindow","event","message","_electron$screen$getP","screen","getPrimaryDisplay","workAreaSize","width","height","options","resizable","fullscreenable","show","webPreferences","affinity","nodeIntegration","loadURL","format","pathname","join","__dirname","protocol","slashes","webContents","openDevTools","once","console","log","on","quit","displaySignUpModal","send","parent","destroySignUpModal","close","createSignUpRequest","post","then","response","sender","data","catch","error","result","status","statusText","displayWaitDialog","frame","hide","socketURL","socketOptions","transports","forceNew","reconnection","reconnectionDelay","reconnectionDelayMax","reconnectionAttempts","Infinity","query","id","getId","token","createSocket","setToken","addHandler","CONNECT","addHandlerWithTokenManager","ERROR","destroyWaitDialog","removeListener","clearHistory","setResizable","setFullScreenable","setMinimumSize","addHandlers","RECONNECT_ATTEMPT","DISCONNECT","TOKENREFRESHREQUIRED","BROADCAST_MESSAGE","RECEIVE_INVITEUSER","getLocale","name","setId"],"mappings":"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","file":"main.js","sourcesContent":["/**\n * Created by kishe56@gmail.com on 2018. 6. 28.\n * Blog : https://kishe89.github.io\n * Github : https://github.com/kishe89\n */\n'use strict';\n\nvar electron = require('electron');\nvar app = electron.app,\n    BrowserWindow = electron.BrowserWindow,\n    ipcMain = electron.ipcMain;\n\nvar url = require('url');\nvar path = require('path');\nvar io = require('socket.io-client');\nvar axios = require('axios');\nvar httpInstance = axios.create({\n  baseURL: 'http://electronexampleserver.mybluemix.net'\n});\n\nvar handler_manager = require('./handler_manager');\nvar SocketService = require('./service/SocketService');\nvar SocketEvent = require('./handler_manager/event/SocketEvent');\nvar TokenManager = require('./service/TokenManager');\nvar tokenManager = new TokenManager();\nvar MainWindowActions = require('./mainProcess/MainWindowActions');\n\nvar win = void 0;\nvar socket = void 0;\nvar modal = void 0;\nvar waitDialog = void 0;\nvar listener = void 0;\nvar errorListener = void 0;\nvar locale = void 0;\n\nvar displayLoginWindow = function displayLoginWindow(event, message) {\n  var _electron$screen$getP = electron.screen.getPrimaryDisplay().workAreaSize,\n      width = _electron$screen$getP.width,\n      height = _electron$screen$getP.height;\n\n  var options = {\n    width: width,\n    height: height,\n    resizable: false,\n    fullscreenable: false,\n    show: false,\n    webPreferences: {\n      affinity: true,\n      nodeIntegration: true\n    }\n  };\n  win = new BrowserWindow(options);\n  win.loadURL(url.format({\n    pathname: path.join(__dirname, 'login.html'),\n    protocol: 'file',\n    slashes: true\n  }));\n  win.webContents.openDevTools();\n  win.once('ready-to-show', function () {\n    console.log('ready-to-show');\n    win.show();\n  });\n  win.on('closed', function () {\n    console.log('window closed');\n    win = null;\n    app.quit();\n  });\n};\nvar displaySignUpModal = function displaySignUpModal(event, message) {\n  win.webContents.send('hide-page');\n  modal = new BrowserWindow({ parent: win, modal: true, show: false });\n\n  modal.loadURL(url.format({\n    pathname: path.join(__dirname, 'SignUpModal.html'),\n    protocol: 'file:'\n  }));\n  modal.once('ready-to-show', function () {\n    modal.show();\n  });\n  modal.on('closed', function () {\n    modal = null;\n  });\n};\nvar destroySignUpModal = function destroySignUpModal(event, message) {\n  win.webContents.send('hide-page');\n  modal.close();\n};\nvar createSignUpRequest = function createSignUpRequest(event, message) {\n  httpInstance.post('/users', message).then(function (response) {\n    event.sender.send('signUpRequest-Success', response.data);\n  }).catch(function (error) {\n    var result = {\n      status: error.response.status,\n      statusText: error.response.statusText\n    };\n    event.sender.send('signUpRequest-Failed', result);\n  });\n};\nvar displayWaitDialog = function displayWaitDialog(event, message) {\n  var options = {\n    width: 800,\n    height: 800,\n    resizable: false,\n    fullscreenable: false,\n    show: false,\n    frame: false,\n    webPreferences: {\n      affinity: true,\n      nodeIntegration: true\n    }\n  };\n  waitDialog = new BrowserWindow(options);\n  waitDialog.loadURL(url.format({\n    pathname: path.join(__dirname, 'WaitDialog.html'),\n    protocol: 'file',\n    slashes: true\n  }));\n  waitDialog.once('ready-to-show', function () {\n    win.hide();\n    waitDialog.show();\n    var socketURL = 'ws://electronexampleserver.mybluemix.net';\n    var socketOptions = {\n      transports: ['websocket'],\n      forceNew: true,\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      reconnectionAttempts: Infinity,\n      query: {\n        id: tokenManager.getId(),\n        token: message.data.token\n      }\n    };\n    socket = SocketService.createSocket(io, socketURL, socketOptions);\n    tokenManager.setToken(message.data.token);\n    listener = SocketService.addHandler(socket, waitDialog, handler_manager[SocketEvent.CONNECT]);\n    errorListener = SocketService.addHandlerWithTokenManager(socket, waitDialog, handler_manager[SocketEvent.ERROR], tokenManager);\n    MainWindowActions(ipcMain, socket, tokenManager);\n  });\n  waitDialog.on('closed', function () {\n    waitDialog = null;\n  });\n};\nvar destroyWaitDialog = function destroyWaitDialog(event, message) {\n  socket.removeListener('connect', listener);\n  socket.removeListener('error', errorListener);\n  win.webContents.clearHistory();\n  win.setResizable(true);\n  win.setFullScreenable(true);\n  win.setMinimumSize(600, 600);\n  win.loadURL(url.format({\n    pathname: path.join(__dirname, 'main.html'),\n    protocol: 'file:',\n    slashes: true\n  }));\n  win.once('ready-to-show', function () {\n    SocketService.addHandlers(socket, win, handler_manager);\n    SocketService.addHandler(socket, win, handler_manager[SocketEvent.CONNECT]);\n    SocketService.addHandlerWithTokenManager(socket, win, handler_manager[SocketEvent.RECONNECT_ATTEMPT], tokenManager);\n    SocketService.addHandlerWithTokenManager(socket, win, handler_manager[SocketEvent.DISCONNECT], tokenManager);\n    SocketService.addHandlerWithTokenManager(socket, win, handler_manager[SocketEvent.TOKENREFRESHREQUIRED], tokenManager);\n    SocketService.addHandlerWithTokenManager(socket, win, handler_manager[SocketEvent.BROADCAST_MESSAGE], tokenManager);\n    SocketService.addHandlerWithTokenManager(socket, win, handler_manager[SocketEvent.RECEIVE_INVITEUSER], tokenManager);\n    SocketService.addHandlerWithTokenManager(socket, win, handler_manager[SocketEvent.ERROR], tokenManager);\n    waitDialog.close();\n    locale = app.getLocale();\n    win.webContents.send('getProfile', { name: tokenManager.getId(), locale: locale });\n    win.show();\n  });\n};\napp.on('ready', displayLoginWindow);\nipcMain.on('displayWaitDialog', displayWaitDialog);\nipcMain.on('destroyWaitDialog', destroyWaitDialog);\nipcMain.on('displaySignUpModal', displaySignUpModal);\nipcMain.on('destroySignUpModal', destroySignUpModal);\nipcMain.on('signUpRequest', createSignUpRequest);\nipcMain.on('signInRequest', function (event, message) {\n  httpInstance.post('/users/login', message).then(function (response) {\n    tokenManager.setId(message.id);\n    event.sender.send('signInRequest-Success', response);\n  }).catch(function (error) {\n    var result = {\n      status: error.response.status,\n      statusText: error.response.statusText\n    };\n    event.sender.send('signInRequest-Failed', result);\n  });\n});\n\napp.on('window-all-closed', function () {\n  app.quit();\n});\napp.on('activate', function () {\n  app.quit();\n});\n//# sourceMappingURL=main.js.map"]}