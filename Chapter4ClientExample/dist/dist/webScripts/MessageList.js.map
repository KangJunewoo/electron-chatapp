{"version":3,"sources":["../../webScripts/MessageList.js"],"names":["MessageList","document","Error","MessageItemFactory","require","items","getElementById","ItemFactory","renderTasks","TaskCount","listener","undefined","prototype","rows","pageNo","addItem","message","messageItem","createItem","id","item","appendChild","push","scrollToBottom","loadItem","Promise","resolve","sortList","reject","list","slice","call","sort","a","b","aDate","getElementsByClassName","bDate","console","log","getAttribute","updateList","_this","messageList","forEach","element","changeSuccessStatus","index","length","changeSuccessStatusMessage","result","splice","childNodes","then","bind","catch","e","changeFailureStatus","changeFailureStatusMessage","clearItems","firstChild","removeChild","lastChild","scrollTop","scrollHeight","setScrollListener","removeEventListener","addEventListener","module","exports"],"mappings":"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","file":"MessageList.js","sourcesContent":["/**\n * Created by kishe56@gmail.com on 2018. 9. 17.\n * Blog : https://kishe89.github.io\n * Github : https://github.com/kishe89\n */\n'use strict';\n\nfunction MessageList(document) {\n  if (!(this instanceof MessageList)) {\n    throw new Error('must be created with new keyword');\n  }\n  var MessageItemFactory = require('./MessageItemFactory');\n  this.items = document.getElementById('messageList');\n  this.ItemFactory = new MessageItemFactory(document);\n  this.renderTasks = [];\n  this.TaskCount = 0;\n  this.listener = undefined;\n}\nMessageList.prototype.rows = [];\nMessageList.prototype.pageNo = 0;\n\nMessageList.prototype.addItem = function (message) {\n  var messageItem = this.ItemFactory.createItem(message);\n  messageItem.id = this.TaskCount;\n  messageItem.item.id = this.TaskCount;\n  this.TaskCount++;\n  this.items.appendChild(messageItem.item);\n  this.renderTasks.push(messageItem);\n  this.scrollToBottom();\n  return messageItem;\n};\nMessageList.prototype.loadItem = function (message) {\n  var messageItem = this.ItemFactory.loadItem(message);\n  this.items.appendChild(messageItem);\n  return Promise.resolve();\n};\nMessageList.prototype.sortList = function (items) {\n  return new Promise(function (resolve, reject) {\n    if (!items) return reject();\n    var list = [].slice.call(items).sort(function (a, b) {\n      var aDate = a.getElementsByClassName('messageElementDate')[0];\n      var bDate = b.getElementsByClassName('messageElementDate')[0];\n      console.log(aDate.getAttribute('data-value') + ' > ' + bDate.getAttribute('data-value') + ' is ' + (aDate.getAttribute('data-value') > bDate.getAttribute('data-value')));\n      return aDate.getAttribute('data-value') > bDate.getAttribute('data-value') ? 1 : -1;\n    });\n    resolve(list);\n  });\n};\nMessageList.prototype.updateList = function (items) {\n  var _this = this;\n\n  var messageList = this.items;\n  items.forEach(function (element) {\n    messageList.appendChild(element);\n    _this.scrollToBottom();\n  });\n};\nMessageList.prototype.changeSuccessStatus = function (message) {\n  for (var index = 0; index < this.renderTasks.length; index++) {\n    if (this.renderTasks[index].id === message.item.id) {\n      this.ItemFactory.changeSuccessStatusMessage(this.renderTasks[index], message.result);\n      this.renderTasks.splice(index, 1);\n      this.TaskCount--;\n      this.sortList(this.items.childNodes).then(this.updateList.bind(this)).catch(function (e) {\n        console.log(e);\n      });\n      return;\n    }\n  }\n};\nMessageList.prototype.changeFailureStatus = function (message, listener) {\n  for (var index = 0; index < this.renderTasks.length; index++) {\n    if (this.renderTasks[index].id === message.item.id) {\n      this.ItemFactory.changeFailureStatusMessage(this.renderTasks[index], message.result, listener);\n      return;\n    }\n  }\n};\nMessageList.prototype.clearItems = function () {\n  var items = this.items;\n  return new Promise(function (resolve, reject) {\n    while (items.firstChild) {\n      items.removeChild(items.lastChild);\n    }\n    resolve();\n  });\n};\n\nMessageList.prototype.scrollToBottom = function () {\n  this.items.scrollTop = this.items.scrollHeight;\n};\nMessageList.prototype.setScrollListener = function (listener) {\n  if (this.listener) {\n    this.items.removeEventListener('scroll', this.listener);\n  }\n  this.listener = listener;\n  this.items.addEventListener('scroll', this.listener);\n};\nmodule.exports = MessageList;\n//# sourceMappingURL=MessageList.js.map"]}