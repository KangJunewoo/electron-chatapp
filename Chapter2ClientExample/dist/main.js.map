{"version":3,"sources":["../main.js"],"names":["electron","require","app","BrowserWindow","ipcMain","url","path","io","axios","httpInstance","create","baseURL","handler_manager","SocketService","win","socket","modal","waitDialog","listener","errorListener","displayLoginWindow","event","message","screen","getPrimaryDisplay","workAreaSize","width","height","options","resizable","fullscreenable","show","webPreferences","affinity","nodeIntegration","loadURL","format","pathname","join","__dirname","protocol","slashes","webContents","openDevTools","once","console","log","on","quit","displaySignUpModal","send","parent","destroySignUpModal","close","createSignUpRequest","post","then","response","sender","data","catch","error","result","status","statusText","displayWaitDialog","frame","hide","socketURL","socketOptions","transports","forceNew","query","token","createSocket","addHandler","destroyWaitDialog","removeListener","addHandlers"],"mappings":"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","file":"main.js","sourcesContent":["/**\n * Created by kishe56@gmail.com on 2018. 6. 28.\n * Blog : https://kishe89.github.io\n * Github : https://github.com/kishe89\n */\n'use strict';\n\nconst electron = require('electron');\nconst {app,BrowserWindow,ipcMain} = electron;\nconst url = require('url');\nconst path = require('path');\nconst io = require('socket.io-client');\nconst axios = require('axios');\nconst httpInstance = axios.create({\n  baseURL:'http://127.0.0.1:3000'\n});\n\nconst handler_manager = require('./handler_manager');\nconst SocketService = require('./service/SocketService');\n\nlet win;\nlet socket;\nlet modal;\nlet waitDialog;\nlet listener;\nlet errorListener;\nconst displayLoginWindow = (event, message)=>{\n  const {width,height} = electron.screen.getPrimaryDisplay().workAreaSize;\n  const options = {\n    width:width,\n    height:height,\n    resizable:false,\n    fullscreenable:false,\n    show:false,\n    webPreferences:{\n      affinity:true,\n      nodeIntegration:true\n    }\n  };\n  win = new BrowserWindow(options);\n  win.loadURL(url.format({\n    pathname:path.join(__dirname,'login.html'),\n    protocol:'file',\n    slashes:true\n  }));\n  win.webContents.openDevTools();\n  win.once('ready-to-show',()=>{\n    console.log('ready-to-show');\n    win.show();\n  });\n  win.on('closed',()=>{\n    console.log('window closed');\n    win = null;\n    app.quit();\n  });\n};\nconst displaySignUpModal = (event,message)=>{\n  win.webContents.send('hide-page');\n  modal = new BrowserWindow({parent:win,modal:true,show:false});\n\n  modal.loadURL(url.format({\n    pathname:path.join(__dirname,'SignUpModal.html'),\n    protocol:'file:'\n  }));\n  modal.once('ready-to-show',()=>{\n    modal.show();\n  });\n  modal.on('closed',()=>{\n    modal = null;\n  });\n};\nconst destroySignUpModal = (event,message)=>{\n  win.webContents.send('hide-page');\n  modal.close();\n};\nconst createSignUpRequest = (event, message)=>{\n  httpInstance.post('/users',message)\n    .then((response)=>{\n      event.sender.send('signUpRequest-Success',response.data);\n    })\n    .catch((error)=>{\n      const result = {\n        status:error.response.status,\n        statusText:error.response.statusText\n      };\n      event.sender.send('signUpRequest-Failed',result);\n    })\n};\nconst displayWaitDialog = (event, message)=>{\n  const options = {\n    width:800,\n    height:800,\n    resizable:false,\n    fullscreenable:false,\n    show:false,\n    frame:false,\n    webPreferences:{\n      affinity:true,\n      nodeIntegration:true\n    }\n  };\n  waitDialog = new BrowserWindow(options);\n  waitDialog.loadURL(url.format({\n    pathname:path.join(__dirname,'WaitDialog.html'),\n    protocol:'file',\n    slashes:true\n  }));\n  waitDialog.once('ready-to-show',()=>{\n    win.hide();\n    waitDialog.show();\n    const socketURL = 'ws://127.0.0.1:3000';\n    const socketOptions = {\n      transports:['websocket'],\n      forceNew:true,\n      query:{\n        token:message.data.token\n      }\n    };\n    socket = SocketService.createSocket(io,socketURL,socketOptions);\n    listener = SocketService.addHandler(socket,waitDialog,handler_manager[0]);\n    errorListener = SocketService.addHandler(socket,waitDialog,handler_manager[1]);\n  });\n  waitDialog.on('closed',()=>{\n    waitDialog = null;\n  });\n};\nconst destroyWaitDialog = (event, message)=>{\n  socket.removeListener('connect',listener);\n  socket.removeListener('error',errorListener);\n  win.loadURL(url.format({\n    pathname:path.join(__dirname,'main.html'),\n    protocol:'file:',\n    slashes:true\n  }));\n  win.once('ready-to-show',()=>{\n    SocketService.addHandlers(socket,win,handler_manager);\n    waitDialog.close();\n    win.show();\n  });\n};\napp.on('ready',displayLoginWindow);\nipcMain.on('displayWaitDialog',displayWaitDialog);\nipcMain.on('destroyWaitDialog',destroyWaitDialog);\nipcMain.on('displaySignUpModal',displaySignUpModal);\nipcMain.on('destroySignUpModal',destroySignUpModal);\nipcMain.on('signUpRequest',createSignUpRequest);\nipcMain.on('signInRequest',(event,message)=>{\n  httpInstance.post('/users/login',message)\n    .then((response)=>{\n\n      event.sender.send('signInRequest-Success',response);\n    })\n    .catch((error)=>{\n      const result = {\n        status:error.response.status,\n        statusText:error.response.statusText\n      };\n      event.sender.send('signInRequest-Failed',result);\n    })\n});\napp.on('window-all-closed',()=>{\n  app.quit();\n});\napp.on('activate',()=>{\n  app.quit();\n});"]}